<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>User Info</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .table{
      width: 100%;
    }
  </style>
</head>
<body class="p-4 bg-light">

  <div class="container">
    <table class="table table-bordered table-striped">
      <thead class="table-dark">
  <tr>
    <th>Username</th>
    <th>Email</th>
    <th>Role</th>
    <th>Actions</th> <!-- New column -->
  </tr>
</thead>
      <tbody id="userTableBody">
        <!-- User data will be inserted here -->
      </tbody>
    </table>
  </div>

  <script>
  
    // fetch('https://ecommerce-backend-wnu9.onrender.com/admin/users')
      fetch('http://localhost:8080/admin/users')
  .then(response => {
    if (!response.ok) {
      throw new Error("Network response was not OK");
    }
    return response.json();
  })
  .then(data => {
    const tableBody = document.getElementById('userTableBody');
    data.forEach(user => {
      const row = `
        <tr>
          <td>${user.username}</td>
          <td>${user.email}</td>
          <td>${user.roles}</td>
          <td>
            <button class="btn btn-sm btn-warning me-1" onclick="showUpdateForm('${user.id}', '${user.username}', '${user.email}')">Update</button>
            <button class="btn btn-sm btn-danger" onclick="deleteUser('${user.id}')">Delete</button>
          </td>
        </tr>`;
      tableBody.insertAdjacentHTML('beforeend', row);
    });
  })
  .catch(error => {
    console.error("Error fetching user data:", error);
  });
// delete------------------>
function deleteUser(userId) {
  if (confirm("Are you sure you want to delete this user?")) {
    fetch(`http://localhost:8080/admin/${userId}`, {
      method: 'DELETE'
    })
    .then(res => {
      if (res.ok) {
        alert("User deleted successfully");
        location.reload(); // refresh to see updated table
      } else {
        alert("Failed to delete user");
      }
    })
    .catch(err => {
      console.error("Delete error:", err);
    });
  }
}
// update------------>
function showUpdateForm(id, currentUsername, currentEmail) {
  const newUsername = prompt("Enter new username:", currentUsername);
  const newEmail = prompt("Enter new email:", currentEmail);
  const newRoles = prompt("Enter roles (comma separated):");

  if (newUsername && newEmail && newRoles) {
    const rolesArray = newRoles.split(',').map(role => role.trim());

    const updatedUser = {
      username: newUsername,
      email: newEmail,
      roles: rolesArray
    };

    fetch(`http://localhost:8080/admin/${id}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(updatedUser)
    })
    .then(res => {
      if (res.ok) {
        alert("User updated successfully");
        location.reload();
      } else {
        alert("Failed to update user");
      }
    })
    .catch(err => {
      console.error("Update error:", err);
    });
  }
}


</script>
</body>
</html>
